# 動態表單配置系統文檔

## 概述
此系統允許您透過後台CMS來控制註冊表單(`web/:id/register`)的字段顯示，可以動態決定哪些字段需要顯示，哪些可以隱藏。

## 功能特點

### ✅ 已實現功能
1. **動態字段顯示/隱藏** - 可以控制任何表單字段的顯示狀態
2. **字段屬性配置** - 可以修改字段標籤、佔位符、必填狀態等
3. **多種字段類型** - 支持文字、電子郵件、電話、下拉選單、多行文字
4. **區塊管理** - 可以創建多個表單區塊並分別控制
5. **實時預覽** - 配置時可以即時預覽表單效果
6. **拖拽排序** - 可以調整字段和區塊的順序
7. **預設配置** - 提供完整的預設表單配置
8. **重置功能** - 可以一鍵重置為預設配置

## 使用流程

### 1. 訪問表單配置管理頁面
```
http://your-domain.com/formConfig/:eventId
```
例如：`http://localhost:3377/formConfig/507f1f77bcf86cd799439010`

### 2. 配置表單字段
- **顯示/隱藏字段**: 使用開關控制字段是否顯示
- **修改字段屬性**: 點擊字段編輯標籤、佔位符、必填狀態等
- **調整字段順序**: 使用拖拽功能調整字段順序
- **配置下拉選單**: 為select類型字段添加選項

### 3. 管理表單區塊
- **創建新區塊**: 點擊"添加新區塊"按鈕
- **刪除區塊**: 點擊區塊右上角的刪除按鈕
- **顯示/隱藏區塊**: 使用區塊開關控制整個區塊的顯示

### 4. 預覽和儲存
- **實時預覽**: 配置變更會即時顯示在預覽區域
- **儲存配置**: 點擊"儲存配置"按鈕保存更改
- **重置配置**: 點擊"重置為預設"恢復原始配置

## 字段類型說明

### 文字字段 (text)
- 用於一般文字輸入
- 可設置佔位符和必填狀態

### 電子郵件 (email)
- 自動驗證電子郵件格式
- 用於收集聯絡人電子郵件

### 電話 (tel)
- 用於電話號碼輸入
- 建議配合電話區號字段使用

### 下拉選單 (select)
- 提供預設選項供用戶選擇
- 可以添加/刪除/修改選項
- 支持必填和可選狀態

### 多行文字 (textarea)
- 用於備註或長文字輸入
- 可設置行數和佔位符

## 預設表單字段

系統提供以下預設字段：

1. **電子郵件** (email) - 必填
2. **姓名** (text) - 必填  
3. **電話區號** (select) - 必填，包含多國區號選項
4. **電話號碼** (tel) - 必填
5. **稱謂** (select) - 必填，包含Mr./Ms./Mrs./Dr./Prof.
6. **公司名稱** (text) - 必填
7. **職位** (text) - 必填
8. **行業** (select) - 可選，包含科技/金融/教育/醫療/零售/其他
9. **交通方式** (select) - 可選，包含地鐵/巴士/計程車/自駕/其他
10. **餐飲選擇** (select) - 可選，包含葷食/素食/清真/無特殊要求
11. **備註** (textarea) - 可選

## API端點

### 獲取表單配置
```
GET /formConfig/:eventId/config
```

### 更新表單配置
```
PUT /formConfig/:eventId/config
Content-Type: application/json

{
    "sections": [
        {
            "sectionName": "contact_info",
            "sectionTitle": "聯絡人資料",
            "visible": true,
            "fields": [
                {
                    "fieldName": "email",
                    "label": "電子郵件",
                    "type": "email",
                    "required": true,
                    "visible": true,
                    "placeholder": "例如：user@example.com"
                }
                // ... 更多字段
            ]
        }
    ]
}
```

### 重置為預設配置
```
POST /formConfig/:eventId/reset
```

## 數據庫結構

### FormConfig 集合
```javascript
{
    _id: ObjectId,
    eventId: ObjectId,      // 關聯的事件ID
    sections: [             // 表單區塊數組
        {
            sectionName: String,     // 區塊名稱
            sectionTitle: String,    // 區塊標題
            visible: Boolean,        // 是否顯示
            order: Number,           // 排序順序
            fields: [                // 字段數組
                {
                    fieldName: String,       // 字段名稱
                    label: String,           // 顯示標籤
                    type: String,            // 字段類型
                    required: Boolean,       // 是否必填
                    visible: Boolean,        // 是否顯示
                    placeholder: String,     // 佔位符
                    options: [               // 選項（select類型）
                        {
                            value: String,
                            label: String
                        }
                    ],
                    order: Number            // 排序順序
                }
            ]
        }
    ],
    createdAt: Date,
    updatedAt: Date
}
```

## 注意事項

1. **權限控制**: 表單配置管理需要管理員權限
2. **數據驗證**: 系統會驗證字段配置的合法性
3. **向後兼容**: 沒有配置的事件會使用預設表單結構
4. **即時生效**: 配置保存後立即生效，無需重啟服務
5. **備份建議**: 建議在重大修改前備份現有配置

## 常見使用場景

### 場景1: 簡化註冊表單
- 隱藏非必要字段（如行業、交通方式、餐飲選擇）
- 只保留基本信息（姓名、電子郵件、公司）

### 場景2: 特定活動需求
- 添加自定義字段（如參加人數、特殊需求）
- 修改字段標籤以符合活動主題

### 場景3: 分階段收集信息
- 創建多個區塊分別收集不同類型的信息
- 控制某些區塊的顯示時機

### 場景4: 國際化支持
- 修改字段標籤為不同語言
- 調整下拉選單選項以符合當地習慣

## 故障排除

### 表單不顯示配置的字段
1. 檢查字段的 `visible` 屬性是否為 `true`
2. 確認所屬區塊的 `visible` 屬性是否為 `true`
3. 檢查字段配置是否已正確保存

### 下拉選單選項不顯示
1. 確認字段類型為 `select`
2. 檢查 `options` 數組是否包含有效的選項
3. 確認選項的 `value` 和 `label` 都已設置

### 配置無法保存
1. 檢查是否有管理員權限
2. 確認事件ID是否正確
3. 檢查表單配置的JSON格式是否正確

